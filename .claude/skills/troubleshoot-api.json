{
  "name": "troubleshoot-api",
  "description": "Diagnose and fix STRATZ API issues",
  "instructions": "Step-by-step troubleshooting guide for STRATZ API problems.\n\n**Common API Issues:**\n\n**1. 401 Unauthorized / Authentication Failed**\n- Check .env file exists and contains VITE_STRATZ_API_TOKEN\n- Verify token is valid at https://stratz.com/api\n- Restart dev server (Ctrl+C, npm run dev)\n- Check API call includes Authorization header\n\n**2. 400 Bad Request / Invalid Query**\n- Verify Steam IDs are Steam32 format (8-9 digits)\n  - Use convertToSteam32() from src/utils/steamId.ts\n  - Steam64 IDs (17 digits) must be converted\n- Check game mode IDs are numbers [1,2,3,4,5,10,16,22], not strings\n- Verify take parameter â‰¤ 100 (API limit)\n- Check GraphQL query syntax (no trailing commas)\n\n**3. 403 Forbidden**\n- Missing 'User-Agent: STRATZ_API' header\n- Check src/api/stratz.ts client configuration\n- Header must be present in all requests\n\n**4. 429 Rate Limited**\n- Too many requests in short time\n- Check if data already cached in IndexedDB\n- Implement exponential backoff\n- Add delays between batch requests\n\n**5. No Data Returned (Empty Results)**\n- Player profile may be private\n- Steam ID may be invalid\n- No matches in specified time window\n- Check game mode filters (Turbo mode 23 excluded)\n\n**6. Player Names Not Showing**\n- Names fetched only after Refresh Player Data\n- Check proSteamAccount.name first, fallback to steamAccount.name\n- Some profiles don't have names (use Steam ID)\n\n**Testing Commands:**\n```bash\n# Test API token\ncurl -H \"Authorization: Bearer YOUR_TOKEN\" -H \"User-Agent: STRATZ_API\" https://api.stratz.com/graphql\n\n# Check .env\ncat .env | grep VITE_STRATZ_API_TOKEN\n\n# Restart dev server\nnpm run dev\n```\n\n**Debug in Code:**\n- Add console.log() in src/api/ files\n- Check Network tab in DevTools\n- Look for GraphQL errors in response payload\n- Verify variables passed to queries\n\n**Quick Fix Checklist:**\n- [ ] .env file exists with valid token\n- [ ] User-Agent header present\n- [ ] Steam32 IDs (not Steam64)\n- [ ] Game modes as numbers\n- [ ] Dev server restarted after .env changes\n- [ ] Check browser console for errors",
  "actions": [
    {
      "type": "bash",
      "command": "grep -n 'VITE_STRATZ_API_TOKEN' .env 2>/dev/null || echo 'No .env file found'"
    }
  ]
}
